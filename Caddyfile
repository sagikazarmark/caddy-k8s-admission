localhost {
    # Simple allow-all webhook - always permits any request
    # Useful for testing webhook connectivity or as a permissive fallback
	route /allow {
		k8s_admission always_allow
	}

	# Simple deny-all webhook - always rejects any request
    # Useful for maintenance mode or blocking all operations on specific resources
	route /deny {
		k8s_admission always_deny
	}

	# Deny CREATE operations
	route /deny/create {
    	k8s_admission validation {
    		expression "operation != 'CREATE'"
            message_expression "'CREATE operations are not allowed for ' + (has(object.kind) ? object.kind : 'unknown') + ' resources'"
    	}
	}

	# Single JSON patch - adds a single label
	route /patch {
		k8s_admission json_patch {
			op add
			path "/metadata/labels/single-patch"
			value "applied"
		}
	}

	# Apply multiple JSON patches
	route /patches {
		k8s_admission json_patches {
			patch {
				op add
				path "/metadata/labels/mutated-by"
				value "caddy-admission-webhook"
			}
			patch {
				op add
				path "/metadata/labels/caddy-admission-controller"
				value "json_patches"
			}
		}
	}

}
